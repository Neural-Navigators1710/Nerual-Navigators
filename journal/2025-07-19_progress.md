# ğŸ› ï¸ Engineering Log â€“ 2025-07-19 â€“ Servo Integration, Vision Refinement & Serial Sync

## ğŸ§  Goal

Integrate servo control with both PiCamera-based obstacle detection and ESP32-based color detection. Finalize visual filtering using calibrated HSV + shape rules and build two-way communication between Raspberry Pi and ESP.

---

## âœ… What I Did Today

- ğŸ¯ **Integrated Pi â†’ Servo Directional Control**
  - Calibrated and tested servo on Raspberry Pi via GPIO
  - Added logic in `main_obstacle.py` to turn 60Â° left or right based on detection
  - Used `RPi.GPIO` for PWM signal control

- ğŸ” **Refined Color + Shape Detection**
  - Updated `obstacle_detection.py` with calibrated HSV for **Red** and **Orange**
  - Added shape filtering using:
    - **Aspect Ratio**: 0.5 â€“ 0.8
    - **Extent**: 0.56 â€“ 0.95
  - Ignored noise beyond **25 cm** distance
  - Verified accuracy of cuboid block detection (10Ã—5Ã—5 cm)

- ğŸ“¡ **Established Piâ€“ESP32 Serial Communication**
  - ESP sends color signals like `"ORANGE"` / `"BLUE"` based on sensor data
  - Pi receives serial data in `main_open.py` and rotates servo accordingly
  - Handled noisy serial data with `.decode(errors='ignore')`

- ğŸ§ª **ESP32 Color Sensor Logic**
  - Used Adafruit TCS34725 on I2C (GPIO21, GPIO22)
  - Wrote normalized RGB filter to distinguish:
    - ğŸŸ  Orange â†’ Turn Right
    - ğŸ”µ Blue â†’ Turn Left
  - Prints clean labels via serial

- ğŸ”§ **General Improvements**
  - Smoothed detection with larger `GaussianBlur`
  - Reduced PiCamera resolution to 320Ã—240 for faster processing
  - Printed AR, EXT, and DIST values in detection logs

---

## ğŸ‘€ Observations

- HSV filtering is stable in constant lighting but may need dynamic adjustment in real match conditions.
- Serial input noise from ESP32 can occasionally cause decode errors â€” resolved with `errors='ignore'`.
- Shape detection reduced false positives drastically.
- Need better positioning for color sensor to avoid ambient light distortion.

---

## ğŸ“Œ To Do Next

- [ ] Calibrate ESP TCS34725 sensor in real field conditions
- [ ] Add timeout failsafe if no signal received from ESP
- [ ] Begin basic lane/line detection logic for Open Challenge
- [ ] Automate movement decisions (not just servo, but full path logic)
- [ ] Start working on wiring diagrams and system flowcharts for documentation

---

## ğŸ“ Repo Update

> Added files/updates:
- `vision/obstacle_detection.py` âœ… [HSV + Shape Detection]
- `main/main_obstacle.py` âœ… [Pi servo turns on vision logic]
- `main/main_open.py` âœ… [ESP signal-controlled servo logic]
- `esp/esp_color_sender.ino` âœ… [Sends ORANGE/BLUE strings over serial]
- `journal/2025-07-20_progress.md` ğŸ“ [This log]

---

ğŸ“… **Next update:** Start designing the decision system for dynamic robot movement and complete ESPâ€“Pi coordination under match conditions.
